---
description: Entwicklungen und Neuerungen an Goobi workflow im Januar 2021
---

# Januar 2021

## Coming soon

- Flex-Editor f√ºr die Erfassung von Handschriften und anderes
- Erweiterung des Rechtemanagements f√ºr individuelle GoobiScripte
- Erweiterung des Dashboards
- Bessere Unterst√ºtzung von K√∂rperschaften

## Neue Funktion f√ºr die Dokumentation von Sch√§den vor dem Beginn der Digitalisierung

Goobi workflow verf√ºgt nun √ºber eine neue Funktionalit√§t f√ºr die Dokumentation von Sch√§den, die bereits beim Anlegen von Vorg√§ngen bekannt sind und mittels Fotos festgehalten werden sollen. Dies ist insbesondere dann hilfreich, wenn die betroffenen Werke beispielsweise an einen Dienstleister ausgeh√§ndigt werden sollen und somit der Zustand der Werke vor der √úbergabe dokumentiert werden soll. Die in diesem Kontext hochgeladenen Fotos und Beschreibungen werden  innerhalb des Vorgangslogs gespeichert und k√∂nnen jederzeit wieder eingesehen werden.

Ein positiver Nebeneffekt, der durch die Einf√ºhrung dieser neuen Funktionalit√§t aufgetreten ist, ist die somit ebenfalls hinzugewonnene neue Funktionalit√§t, dass ab jetzt auch direkt beim Anlegen von Vorg√§ngen Masterbilder und andere Dateien bereits in Goobi eingespielt werden k√∂nnen, ohne dass dies in einem eigenen Arbeitsschritt passieren muss. Dies d√ºrfte sich insbesondere f√ºr kleine Projektteams als praktische Neuerung erweisen.

Um diese neue Funktionalit√§t zu aktivieren, muss innerhalb der Konfigurationsdatei `/opt/digiverso/goobi/config/goobi_projects.xml` folgender Block innerhalb es Elements `<createNewProcess>` f√ºr einzelne Projekte definiert sein:

```xml
<fileupload use="true">
    <folder>intern</folder>
</fileupload>         
```

Sobald diese Funktion aktiviert ist, passt sich die Nutzeroberfl√§che von Goobi workflow daraufhin an, indem beim Anlegen von Vorg√§ngen nicht mehr der Button zum Speichern angezeigt wird, sondern stattdessen ein Button sichtbar wird, der zur n√§chsten Seite f√ºhrt.

![Oberf√§che der Anlegemaske mit Button, um zur n√§chsten Seite zu gelangen](../.gitbook/assets/2101_damages01_de.png)

Soll nicht nur ein Upload von Schadensdokumentationen erfolgen sonden auch bereits vor dem Anlegen von Vorg√§ngen ein Upload von Dateien in ausgew√§hlte Ordner erm√∂glicht werden, kann die Konfiguration beispielhaft wie folgt vorgenommen werden:

```xml
<fileupload use="true">
    <folder>intern</folder>
    <folder>export</folder>
    <folder>master</folder>
    <folder>media</folder>
</fileupload>         
```

Hat der Nutzer auf den Button zum Gelangen auf die n√§chste Seite geklickt, so kann hier ein globaler Kommentar eingegeben werden, der f√ºr alle Bilder gelten soll. Anschlie√üend kann der Upload der Dateien erfolgen.

![Globaler Kommentar f√ºr alle hochzulandenden Bilder](../.gitbook/assets/2101_damages03_de.png)

Nach dem Hochladen in den gew√§hlten Ordner werden die Bilder samt zugeh√∂rigem Kommentar angezeigt und beim Vorgang gespeichert. Die Kommentare zu den einzelnen Bildern k√∂nnen nat√ºrlich pro Bild individuell sein. 

![Individuelle Kommentare pro Bild f√ºr erkennbare Sch√§den](../.gitbook/assets/2101_damages04_de.png)

Zu beachten ist, dass die Kommentare ausschlie√ülich f√ºr diejenigen Bilder gespeichert werden, die in den Ordner `√¨ntern` als Schadensdokumentation geladen werden. Bilder, die hingegen z.B. als Masterbilder hochgeladen werden, verf√ºgen nicht √ºber die M√∂glichkeit pro Datei einen Kommentar mitzuf√ºhren.

## Anzeige der Schadensdokumentation innerhalb des Laufzettels

Die neue Funktion f√ºr die Schadensdokumentation kann innerhalb der automatisch generierten Laufzettel ber√ºcksichtigt werden. Dabei werden alle hochgeladenen Bilder samt der zugeh√∂rigen Kommentare auf den Folgeseiten des Laufzeittels aufgef√ºhrt.

![Anzeige der Schadensdokumentation auf dem Laufzettel](../.gitbook/assets/2101_damages05_de.png)

Zur Aktivierung dieser Anzeige im Laufzettel sollte in die Konfigurationsdateien `/opt/digiverso/goobi/xslt/docket.xsl` und `/opt/digiverso/goobi/xslt/docket_english.xsl` ein Block wie der folgende eingef√ºgt werden:

```xml
<xsl:if test="goobi:log/goobi:file">
  <fo:page-sequence master-reference="A5">
    <fo:flow flow-name="xsl-region-body" font-family="opensans, unicode">

      <!-- title of process -->
      <fo:block text-align="center" font-weight="bold" font-size="11pt" margin-top="0pt">
          <xsl:text disable-output-escaping="yes">Schadensdokumentation f√ºr: </xsl:text>
          <xsl:value-of select="goobi:title"/>
      </fo:block>
      <!-- // title of process -->
      <fo:block border-top-width="1pt" border-top-style="solid" border-top-color="#cccccc" margin-top="10pt"/>

      <!-- show all images uploaded into the process log -->
      <xsl:for-each select="goobi:log/goobi:file">
        <xsl:if test="not(position() > 20)">
          <fo:block text-align="center" font-size="12pt" margin-top="10pt">
            <fo:external-graphic src="url('{@url}')" content-height="80mm"/>
          </fo:block>
          <fo:block text-align="center" font-size="9pt" margin-top="5pt">
            <xsl:value-of select="@comment" />
          </fo:block>
        </xsl:if>
      </xsl:for-each>
      <!-- // show all images uploaded into the process log -->

    </fo:flow>
  </fo:page-sequence>
</xsl:if>
```

![Eine Schadensdokumentation kann aus vielen Bildern bestehen, die alle auf dem Laufzettel angezeigt werden](../.gitbook/assets/2101_damages07_de.png)

## Komprimierter Repr√§sentant bei der Generierung der Metadaten-PDF-Datei

Die PDF-Datei die Goobi auf Basis der Metadaten erzeugen kann, enth√§lt √ºblicherweise ein Bild des Repr√§sentanten. Dieses Bild war bisher in unkomprimierter Fassung enthalten, so dass die PDF-Dateien zum Teil sehr gro√ü waren. Dies wurde nun so ge√§ndert, dass die eingebetteten Bilder nun zun√§chst duch eine JPEG-Kompression laufen und erst im Anschlu√ü in die PDF-Datei eingebettet werden. In dem Kontext wurde auch eine Anpassung f√ºr die Konfiguration der Gestaltung dieser PDF-Dateien vorgenommen. Entsprechend m√ºssen diese √Ñnderungen bei Updates nun ebenfalls in den Goobi-Installationen ber√ºcksichtigt werden. Bisher wurde √ºblicherweise dieser Block in der Konfigurationsdatei `/opt/digiverso/goobi/xslt/docket_metadata.xsl` verwendet:

```xml
<!-- thumbnail on right side -->
<fo:block-container position="fixed" left="11.5cm" top="1cm">
  <fo:block>
      <fo:external-graphic src="url('{goobi:thumbnail}')" content-height="100mm"/>
  </fo:block>
</fo:block-container>
<!-- // thumbnail on right side -->
```

Dieser Block muss bez√ºglich des Bildpfades von nun an wie folgt angepasst werden:

```xml
<!-- thumbnail on right side -->
<fo:block-container position="fixed" left="11.5cm" top="1cm">
  <fo:block>
      <fo:external-graphic src="url('{goobi:representative/@url}')" content-height="100mm"/>
  </fo:block>
</fo:block-container>
<!-- // thumbnail on right side -->
```

Das Encoding der Datei sollte dar√ºber hinaus angepasst werden, so dass es auf `utf-8` umgestellt ist:

```xml
<?xml version="1.0" encoding="utf-8"?>
```

## Anpassung f√ºr den Standard-Laufzettel

Der Standard-Laufzettel von Goobi workflow ben√∂tigt ebenfalls eine √Ñnderung innerhalb der Konfiguration f√ºr die korrekte Anzeige des intern umbenannten Anlegedatums f√ºr den Vorgang. Bisher wurde √ºblicherweise dieser Ausdruck in den Konfigurationsdateien `/opt/digiverso/goobi/xslt/docket.xsl` und `/opt/digiverso/goobi/xslt/docket_english.xsl` verwendet:

```xml
<xsl:value-of select="goobi:time"/>
```

Dieser Ausdruck muss wie folgt angepasst werden:

```xml
<xsl:value-of select="goobi:creationDate"/>
```

Und auch das Encoding dieser Dateien sollte angepasst werden, so dass es auf `utf-8` umgestellt ist:

```xml
<?xml version="1.0" encoding="utf-8"?>
```

## Anpassung f√ºr den Batch-Laufzettel

Auch der Batch-Laufzettel ben√∂tigt eine √Ñnderung in der Konfiguration f√ºr die korrekte Anzeige des Anlegedatums f√ºr der Vorg√§nge.

In der Datei `/opt/digiverso/goobi/xslt/docket_multipage.xsl` stand bisher dieser Wert:

```xml
<xsl:value-of select="goobi:process/goobi:time" />
```

Dieser Ausdruck muss wie folgt angepasst werden:

```xml
<xsl:value-of select="goobi:process/goobi:creationDate" />
```

Auch hier sollte das Encoding der Datei angepasst werden, um es auf `utf-8` umzustellen:

```xml
<?xml version="1.0" encoding="utf-8"?>
```

## Catalogue Poller und Catalogue Request mit erweiterten Funktionen

Seit einiger Zeit schon verf√ºgt Goobi √ºber zwei verschiedene Plugins, um auch im laufenden Workflow bzw. sogar periodisch Katalogabfragen durchf√ºhren zu k√∂nnen, damit Metadaten importiert bzw. aktualisiert werden. Diese beiden Plugins wurden einmal gr√ºndlich erweitert und in ihrer Dokumentation angepasst. F√ºr den Catalogue Poller wurde eine neue Zeitsteuerung implementiert, die erlaubt, dass gezielt definierte Datenbest√§nde in konfigurierbaren Zeitabst√§nden aktualisiert werden. Dar√ºber hinaus sind sowohl der `Catalogue Poller` als auch das `Catalogue Request Plugin`dahingehend erweitert worden, dass jetzt auch f√ºr Unterelemente Abfragen an den Katalog gestellt werden k√∂nnen, um diese zu aktualisieren. 

![Konfigurierbare Updates der Metadaten mit dem Catalogue Poller](../.gitbook/assets/2101_catalogue_poller_de.png)

Wie genau die Konfiguration aufgebaut sein muss, um diese neuen Funktionen verwenden zu k√∂nnen, ist in den jeweiligen Dokumentationen der beiden Plugins erl√§utert.

Hier findet sich die neue ausf√ºhrliche Dokumentation des Catalogue Request Plugins:

{% embed url="https://docs.goobi.io/goobi-workflow-plugins-de/step/intranda_step_catalogue_request" caption="https://docs.goobi.io/goobi-workflow-plugins-de/step/intranda_step_catalogue_request" %}

Und hier findet sich die aktualisierte Dokumentation des Catalogue Pollers:

{% embed url="https://docs.goobi.io/goobi-workflow-plugins-de/administration/intranda_administration_catalogue_poller" caption="https://docs.goobi.io/goobi-workflow-plugins-de/administration/intranda_administration_catalogue_poller" %}

## Neue GoobiScript Syntax (YAML)

Mit GoobiScript verf√ºgt Goobi workflow schon seit geraumer Zeit √ºber einen Mechanismus, um auch umfangreiche Listen an Vorg√§ngen in Masse √§ndern zu k√∂nnen. Dies kann die Durchf√ºhrung von Exporten sein, √Ñnderungen am Workflowstatus betreffen, das Hinzuf√ºgen von Metadaten innerhalb der METS-Dateien umfassen und vieles mehr. √úber die Jahre sind zahlreiche GoobiScripte mit jeweils neuen Funktionen hinzugekommen, die wir auch jeweils auf einer eigenen Dokumentationsseite detailliert erl√§utern. Dennoch fanden wir den Aufbau der Kommandos langfristig nicht f√ºr den richtigen Weg, so dass wir uns dazu entschieden haben, hier eine gr√∂√üere Umstellung vorzunehmen. Statt der bisherigen Syntax verwendet GoobiScript nun die Sprache YAML zur definition von GoobiScripten. Der Aufbau der Kommandos ist damit ein bisschen anders als in der Vergangenheit. Allerdings bringt die Umstellung mehrere gro√üe Vorteile mit sich.

![√úberarbeitete Syntax f√ºr GoobiScript](../.gitbook/assets/2101_goobiscript1_de.png)

Einerseits verf√ºgt die Darstellung der Kommandos von nun an √ºber ein Syntax-Highlighting, so dass das Lesen und Schreiben der GoobiScripte durch die Formatierung und Farben deutlich √ºbersichtlicher geworden ist. Und zum anderen bringen alle GoobiScripte von nun auch eine eigene eingebettete Dokumentation samt Beispielen mit, die √ºber jedem Parameter jeweils aufgef√ºhrt wird. Damit ist die Rechnerche, wie ein spezielles Kommando zu verwenden ist noch einmal deutlich einfacher geworden.

```yaml
---
# This GoobiScript allows to assign a user group to an existing workflow step.
action: addUserGroup

# Title of the workflow step to be edited
steptitle: Upload images

# Use the name of the user group to be assigned to the selected workflow step.
group: Photographers
```

Ein weiterer enormer Zugewinn der Umstellung auf das neue Format YAML ist, dass wir nun auch sehr √ºbersichtlich verschiedene GoobiScripte √ºbersichtlich hintereinander im gleichen Aufruf kombinieren k√∂nnen, indem diese jeweils mit der Trennlinie als Separator nacheinander aufgef√ºhrt werden. 

```yaml
---
# This GoobiScript allows to add a new workflow step into the workflow.
action: addStep

# Title of the workflow step to add
steptitle: Upload images

# This number defines where in the workflow this new step is ordered into.
number: 3

---
# This GoobiScript allows to assign a user group to an existing workflow step.
action: addUserGroup

# Title of the workflow step to be edited
steptitle: Upload images

# Use the name of the user group to be assigned to the selected workflow step.
group: Photographers

---

[...]

```

Hierbei kann die mitgelieferte Dokumentation f√ºr eine bessere √úbersicht auch einfach entfernt werden:

![Mehrere Kommandos ohne Dokumentation √ºbersichtlich zusammen absenden](../.gitbook/assets/2101_goobiscript2_de.png)

Die Dokumentation f√ºr die Verwendung von GoobiScript findet sich hier, wo die Bedienung und M√∂glichkeiten genau erl√§utert werden:

{% embed url="https://docs.goobi.io/goobi-workflow-de/manager/7/7.4" caption="https://docs.goobi.io/goobi-workflow-de/manager/7/7.4" %}

## Neues GoobiScript "addStepAtOtherStepPosition"

Es wurde ein neues GoobiScript entwickelt, dass es nun erm√∂glicht, dass neue Arbeitsschritte besser in den Workflow integriert werden k√∂nnen. Mit diesem Kommando ist es nun m√∂glich, die neue Zielposition innerhalb des Workflows anzugeben, die noch durch einen anderen Arbeitsschritt belegt wird. Durch den Aufruf dieses Kommandos ist es nun m√∂glich, dass der neue Arbeitsschritt an dieser gew√ºnschten Postion eingef√ºgt wird und alle nachfolgenden Arbeitsschritte entsprechend an die richtigen Postionen verschoben werden.

```yaml
---
# This GoobiScript allows to add a new workflow step into the workflow before or after another step (defined by name).
action: addStepAtOtherStepPosition

# The new step can be executed "before" or "after" the existing step.
insertionstrategy: after

# Title of the existing workflow step
existingsteptitle: Scanning

# Title of the new workflow step
newsteptitle: Analyzing
```

![Neues GoobiScript zum Einf√ºgen von Arbeitsschritten zwischen existierenden Schritten](../.gitbook/assets/2101_goobiscript3_de.png)

Die Dokumentation f√ºr das neue GoobiScript findet sich hier:

{% embed url="https://docs.goobi.io/goobi-workflow-de/manager/7/7.4#goobiscript-addstepatotherstepposition" caption="https://docs.goobi.io/goobi-workflow-de/manager/7/7.4#goobiscript-addstepatotherstepposition" %}

## Nutzung von CDI

Der technische Unterbau von Goobi workflow wurde auf CDI umgestellt. Diese √Ñnderung war n√∂tig, um Goobi workflow auch in Zukunft mit wichtigen Sicherheitsupdates versorgen zu k√∂nnen. Au√üerdem er√∂ffnet uns dieser Umstieg einige neue technische M√∂glichkeiten, wie zum Beispiel die Nutzung von Websockets. Mit Websockets kann der Server den Client (also den Webbrowser) proaktiv √ºber √Ñnderungen informieren. Diese neue Technologie ist zum Beispiel f√ºr l√§nger laufende Aufgaben wie Importe oder auch die GoobiScripte au√üerst praktisch, um den Nutzer √ºber den Fortschritt informiert zu halten. 